

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - Dükkan Bulut</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/store.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchModalEl = document.getElementById('searchModal');
            if (!searchModalEl) return;

            const input = document.getElementById('globalSearchInput');
            const resultsContainer = document.getElementById('searchResultsContainer');

            // When modal opens, reset state and focus
            searchModalEl.addEventListener('shown.bs.modal', function () {
                if (!input || !resultsContainer) return;
                input.value = '';
                resultsContainer.innerHTML =
                    '<div class="text-muted small">Bir ürün adı yazarak arama yapın.</div>';
                input.focus();
            });

            let typingTimer = null;
            const debounceMs = 300;

            function renderMessage(html) {
                if (resultsContainer) {
                    resultsContainer.innerHTML = html;
                }
            }

            function performSearch(query) {
                query = (query || '').trim();
                if (!query) {
                    renderMessage('<div class="text-muted small">Bir ürün adı yazarak arama yapın.</div>');
                    return;
                }

                fetch('@Url.Action("Search", "Home")?q=' + encodeURIComponent(query))
                    .then(r => {
                        if (!r.ok) throw new Error();
                        return r.text();
                    })
                    .then(html => {
                        resultsContainer.innerHTML = html;
                    })
                    .catch(() => {
                        renderMessage('<div class="text-danger small">Arama sırasında bir hata oluştu.</div>');
                    });
            }

            if (input) {
                input.addEventListener('input', function () {
                    const q = this.value;
                    clearTimeout(typingTimer);
                    typingTimer = setTimeout(function () {
                        performSearch(q);
                    }, debounceMs);
                });
            }
        });
    </script>

    <script>
        // Block Shift+Enter everywhere EXCEPT textarea
        (function () {
            document.addEventListener('keydown', function (e) {
                if (e.key !== 'Enter' || !e.shiftKey) return;

                const el = e.target;
                if (!el) return;

                // allow Shift+Enter inside textarea (newline)
                if (el.tagName === 'TEXTAREA') return;

                // also allow any contenteditable (if you ever add rich text later)
                if (el.isContentEditable) return;

                e.preventDefault();
                e.stopPropagation();
            }, true); // <-- capture mode is important
        })();
    </script>

</head>
<body>
    @RenderBody()

    @RenderSection("Scripts", required: false)
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>